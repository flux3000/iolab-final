<?php
//username sliaheac@wegwerfemail.de
//passw sliaheac@wegwerfemail.de
//api key Fmjtd%7Cluubn16rn0%2Crl%3Do5-90asl0 

require_once 'constants.php';
$mysqli = new mysqli(HOST, USER, PASSWORD, DATABASE);
if($mysqli->connect_errno){printf("Connect failed: %s\n", $mysqli->connect_error);exit();}

$stmt = $mysqli->prepare("SELECT `city`, `state` FROM `ufos` GROUP BY `city` ORDER BY COUNT(*) DESC");
$stmt->execute();
$stmt->bind_result($cityR, $stateR);

$stateStr = "";
$count = 1;
while ($stmt->fetch()) {
	if($count <= 100){
		$count++;
		$city = urlencode($cityR);
		$state = urlencode($stateR);
		
		$stateStr .= "&location=" . $city . "," . $state;
	}
}

$key = "Fmjtd%7Cluubn16rn0%2Crl%3Do5-90asl0";
$url = "http://www.mapquestapi.com/geocoding/v1/batch?key=".$key.$stateStr."&thumbMaps=false&maxResults=1&outFormat=csv";

//$res = file_get_contents($url);
//echo $res;

$res = '"Country","State","County","City","PostalCode","Street","Lat","Lng","DragPoint","LinkId","Type","GeocodeQualityCode","GeocodeQuality","SideOfStreet","DisplayLat","DisplayLng" "US","WA","King County","Seattle","","","47.603561","-122.329437","false","0","s","A5XAX","CITY","N","47.603561","-122.329437" "US","AZ","Maricopa County","Phoenix","","","33.448261","-112.075768","false","0","s","A5XAX","CITY","N","33.448261","-112.075768" "US","OR","Multnomah County","Portland","","","45.511791","-122.675629","false","0","s","A5XAX","CITY","N","45.511791","-122.675629" "US","NV","Clark County","Las Vegas","","","36.171909","-115.139969","false","0","s","A5XAX","CITY","N","36.171909","-115.139969" "US","CA","Los Angeles County","Los Angeles","","","34.05349","-118.245323","false","0","s","A5XAX","CITY","N","34.05349","-118.245323" "US","CA","San Diego County","San Diego","","","32.715691","-117.16172","false","0","s","A5XAX","CITY","N","32.715691","-117.16172" "US","TX","Harris County","Houston","","","29.76045","-95.369781","false","0","s","A5XAX","CITY","N","29.76045","-95.369781" "US","IL","Cook County","Chicago","","","41.884151","-87.632408","false","0","s","A5XAX","CITY","N","41.884151","-87.632408" "US","FL","Miami-Dade County","Miami","","","25.728979","-80.237419","false","0","s","A5XAX","CITY","N","25.728979","-80.237419" "US","AZ","Pima County","Tucson","","","32.22155","-110.969749","false","0","s","A5XAX","CITY","N","32.22155","-110.969749" "US","OH","Clark County","Springfield","","","39.925018","-83.806732","false","0","s","A5XAX","CITY","N","39.925018","-83.806732" "US","TX","Travis County","Austin","","","30.267599","-97.742981","false","0","s","A5XAX","CITY","N","30.267599","-97.742981" "US","FL","Orange County","Orlando","","","28.538231","-81.377388","false","0","s","A5XAX","CITY","N","28.538231","-81.377388" "GB","England","London","London","","","51.5072759","-0.1276597","false","0","s","A5XXX","CITY","N","51.5072759","-0.1276597" "US","CA","Sacramento County","Sacramento","","","38.57906","-121.491013","false","0","s","A5XAX","CITY","N","38.57906","-121.491013" "US","CA","San Francisco County","San Francisco","","","37.777119","-122.41964","false","0","s","A5XAX","CITY","N","37.777119","-122.41964" "US","GA","Muscogee County","Columbus","","","32.462921","-84.987633","false","0","s","A5XAX","CITY","N","32.462921","-84.987633" "US","NM","Bernalillo County","Albuquerque","","","35.084179","-106.648643","false","0","s","A5XAX","CITY","N","35.084179","-106.648643" "US","IA","","","","","42.036919","-93.4664","false","0","s","A3XAX","STATE","N","42.036919","-93.4664" "US","CA","Santa Clara County","San Jose","","","37.33847","-121.885788","false","0","s","A5XAX","CITY","N","37.33847","-121.885788" "US","TX","Bexar County","San Antonio","","","29.42449","-98.494621","false","0","s","A5XAX","CITY","N","29.42449","-98.494621" "US","CO","Denver County","Denver","","","39.740009","-104.992264","false","0","s","A5XAX","CITY","N","39.740009","-104.992264" "CA","ON","","","","","50.0","-85.0","false","0","s","A3XAX","STATE","N","50.0","-85.0" "US","NC","Onslow County","Jacksonville","","","34.74929","-77.421051","false","0","s","A5XAX","CITY","N","34.74929","-77.421051" "US","GA","Paulding County","Dallas","","","33.925179","-84.84153","false","0","s","A5XAX","CITY","N","33.925179","-84.84153" "US","SC","Horry County","Myrtle Beach","","","33.693569","-78.882668","false","0","s","A5XAX","CITY","N","33.693569","-78.882668" "US","TN","Dickson County","Charlotte","","","36.17767","-87.338837","false","0","s","A5XAX","CITY","N","36.17767","-87.338837" "US","NY","Wayne County","York","","","43.20406","-76.939217","false","0","s","A5XAX","CITY","N","43.20406","-76.939217" "US","OR","Marion County","Salem","","","44.933262","-123.043808","false","0","s","A5XAX","CITY","N","44.933262","-123.043808" "US","IL","Cook County","Tinley Park","","","41.596401","-87.785141","false","0","s","A5XAX","CITY","N","41.596401","-87.785141" "US","PA","Lancaster County","Columbia","","","40.0336","-76.504478","false","0","s","A5XAX","CITY","N","40.0336","-76.504478" "US","WA","Clark County","Vancouver","","","45.63221","-122.671562","false","0","s","A5XAX","CITY","N","45.63221","-122.671562" "US","KY","Jefferson County","Louisville","","","38.25486","-85.766403","false","0","s","A5XAX","CITY","N","38.25486","-85.766403" "US","IN","Marion County","Indianapolis","","","39.766911","-86.149963","false","0","s","A5XAX","CITY","N","39.766911","-86.149963" "US","AZ","Maricopa County","Mesa","","","33.417042","-111.831459","false","0","s","A5XAX","CITY","N","33.417042","-111.831459" "US","IN","Wayne County","Richmond","","","39.830109","-84.890327","false","0","s","A5XAX","CITY","N","39.830109","-84.890327" "US","IL","Winnebago County","Rockford","","","42.266899","-89.078346","false","0","s","A5XAX","CITY","N","42.266899","-89.078346" "US","NY","New York County","New York City","","","40.71455","-74.007118","false","0","s","A5XAX","CITY","N","40.71455","-74.007118" "US","MO","Saint Louis (City) County","Saint Louis","","","38.627739","-90.199509","false","0","s","A5XAX","CITY","N","38.627739","-90.199509" "US","WA","Pierce County","Tacoma","","","47.255131","-122.44165","false","0","s","A5XAX","CITY","N","47.255131","-122.44165" "US","WA","King County","Auburn","","","47.3074","-122.230408","false","0","s","A5XAX","CITY","N","47.3074","-122.230408" "US","VA","Arlington County","Arlington","","","38.890511","-77.086288","false","0","s","A5XAX","CITY","N","38.890511","-77.086288" "US","WA","Spokane County","Spokane","","","47.657261","-117.412277","false","0","s","A5XAX","CITY","N","47.657261","-117.412277" "US","CO","El Paso County","Colorado Springs","","","38.83345","-104.821808","false","0","s","A5XAX","CITY","N","38.83345","-104.821808" "US","MO","Jackson County","Kansas City","","","39.102951","-94.583061","false","0","s","A5XAX","CITY","N","39.102951","-94.583061" "US","NY","Monroe County","Rochester","","","43.155499","-77.616028","false","0","s","A5XAX","CITY","N","43.155499","-77.616028" "US","NE","Douglas County","Omaha","","","41.260689","-95.94059","false","0","s","A5XAX","CITY","N","41.260689","-95.94059" "US","FL","Hillsborough County","Tampa","","","27.946529","-82.459267","false","0","s","A5XAX","CITY","N","27.946529","-82.459267" "US","WI","Dane County","Madison","","","43.072948","-89.386688","false","0","s","A5XAX","CITY","N","43.072948","-89.386688" "US","NV","Washoe County","Reno","","","39.52739","-119.813408","false","0","s","A5XAX","CITY","N","39.52739","-119.813408" "US","UT","Salt Lake County","Salt Lake City","","","40.759499","-111.888229","false","0","s","A5XAX","CITY","N","40.759499","-111.888229" "CA","BC","","","","","54.0","-124.5","false","0","s","A3XAX","STATE","N","54.0","-124.5" "US","NJ","Ocean County","Jackson","","","40.130341","-74.273941","false","0","s","A5XAX","CITY","N","40.130341","-74.273941" "US","PA","Philadelphia County","Philadelphia","","","39.952278","-75.162453","false","0","s","A5XAX","CITY","N","39.952278","-75.162453" "US","AZ","Maricopa County","Scottsdale","","","33.493999","-111.920692","false","0","s","A5XAX","CITY","N","33.493999","-111.920692" "US","TN","Davidson County","Nashville","","","36.167782","-86.778358","false","0","s","A5XAX","CITY","N","36.167782","-86.778358" "US","OK","Tulsa County","Tulsa","","","36.149738","-95.993332","false","0","s","A5XAX","CITY","N","36.149738","-95.993332" "US","CA","Fresno County","Fresno","","","36.740681","-119.785728","false","0","s","A5XAX","CITY","N","36.740681","-119.785728" "US","WA","Snohomish County","Everett","","","47.97657","-122.206421","false","0","s","A5XAX","CITY","N","47.97657","-122.206421" "US","NC","New Hanover County","Wilmington","","","34.23497","-77.945992","false","0","s","A5XAX","CITY","N","34.23497","-77.945992" "US","PA","Lancaster County","Lancaster","","","40.03804","-76.30127","false","0","s","A5XAX","CITY","N","40.03804","-76.30127" "US","OH","Cuyahoga County","Cleveland","","","41.504711","-81.690742","false","0","s","A5XAX","CITY","N","41.504711","-81.690742" "US","GA","Fulton County","Atlanta","","","33.74831","-84.391113","false","0","s","A5XAX","CITY","N","33.74831","-84.391113" "US","PA","Allegheny County","Pittsburgh","","","40.438332","-79.997459","false","0","s","A5XAX","CITY","N","40.438332","-79.997459" "US","OH","Sandusky County","Bellevue","","","41.273361","-82.842293","false","0","s","A5XAX","CITY","N","41.273361","-82.842293" "US","ID","Ada County","Boise","","","43.606979","-116.193413","false","0","s","A5XAX","CITY","N","43.606979","-116.193413" "US","AZ","Maricopa County","Glendale","","","33.538581","-112.186279","false","0","s","A5XAX","CITY","N","33.538581","-112.186279" "US","OH","Hamilton County","Cincinnati","","","39.106609","-84.504547","false","0","s","A5XAX","CITY","N","39.106609","-84.504547" "US","CA","Riverside County","Riverside","","","33.981628","-117.373878","false","0","s","A5XAX","CITY","N","33.981628","-117.373878" "US","SC","Lexington County","Lexington","","","33.98061","-81.236183","false","0","s","A5XAX","CITY","N","33.98061","-81.236183" "US","DC","District Of Columbia County","Washington","","","38.890369","-77.03196","false","0","s","A5XAX","CITY","N","38.890369","-77.03196" "US","OR","Lane County","Eugene","","","44.049919","-123.088539","false","0","s","A5XAX","CITY","N","44.049919","-123.088539" "US","CA","Los Angeles County","Long Beach","","","33.76672","-118.192398","false","0","s","A5XAX","CITY","N","33.76672","-118.192398" "US","AZ","Maricopa County","Gilbert","","","33.32904","-111.789757","false","0","s","A5XAX","CITY","N","33.32904","-111.789757" "US","MD","Baltimore (City) County","Baltimore","","","39.29055","-76.609596","false","0","s","A5XAX","CITY","N","39.29055","-76.609596" "US","MN","Hennepin County","Minneapolis","","","44.979031","-93.264931","false","0","s","A5XAX","CITY","N","44.979031","-93.264931" "US","TN","Shelby County","Memphis","","","35.149761","-90.049248","false","0","s","A5XAX","CITY","N","35.149761","-90.049248" "US","GA","Cherokee County","Canton","","","34.236252","-84.487328","false","0","s","A5XAX","CITY","N","34.236252","-84.487328" "US","NY","Albany County","Albany","","","42.65144","-73.755249","false","0","s","A5XAX","CITY","N","42.65144","-73.755249" "US","VA","Virginia Beach (City) County","Virginia Beach","","","36.75502","-76.059196","false","0","s","A5XAX","CITY","N","36.75502","-76.059196" "US","NE","Lancaster County","Lincoln","","","40.813622","-96.707741","false","0","s","A5XAX","CITY","N","40.813622","-96.707741" "US","WA","Whatcom County","Bellingham","","","48.75235","-122.471222","false","0","s","A5XAX","CITY","N","48.75235","-122.471222" "US","WA","Yakima County","Yakima","","","46.60413","-120.50705","false","0","s","A5XAX","CITY","N","46.60413","-120.50705" "US","CO","Jefferson County","Lakewood","","","39.710949","-105.082733","false","0","s","A5XAX","CITY","N","39.710949","-105.082733" "US","WA","Snohomish County","Monroe","","","47.852402","-121.981506","false","0","s","A5XAX","CITY","N","47.852402","-121.981506" "US","TX","El Paso County","El Paso","","","31.759159","-106.487488","false","0","s","A5XAX","CITY","N","31.759159","-106.487488" "US","TN","Knox County","Knoxville","","","35.960491","-83.920914","false","0","s","A5XAX","CITY","N","35.960491","-83.920914" "US","NY","Erie County","Buffalo","","","42.885441","-78.878464","false","0","s","A5XAX","CITY","N","42.885441","-78.878464" "US","AZ","Maricopa County","Chandler","","","33.303379","-111.840828","false","0","s","A5XAX","CITY","N","33.303379","-111.840828" "US","CA","Kern County","Bakersfield","","","35.366959","-119.01886","false","0","s","A5XAX","CITY","N","35.366959","-119.01886" "CA","ON","","","","","50.0","-85.0","false","0","s","A3XAX","STATE","N","50.0","-85.0" "US","CA","Los Angeles County","Burbank","","","34.181469","-118.308121","false","0","s","A5XAX","CITY","N","34.181469","-118.308121" "US","TX","Tarrant County","Fort Worth","","","32.748852","-97.329391","false","0","s","A5XAX","CITY","N","32.748852","-97.329391" "US","OR","Marion County","Aurora","","","45.22961","-122.755859","false","0","s","A5XAX","CITY","N","45.22961","-122.755859" "US","IN","Johnson County","Franklin","","","39.483822","-86.06411","false","0","s","A5XAX","CITY","N","39.483822","-86.06411" "US","WA","Kitsap County","Bremerton","","","47.564999","-122.627472","false","0","s","A5XAX","CITY","N","47.564999","-122.627472" "US","MI","Kent County","Grand Rapids","","","42.966412","-85.671181","false","0","s","A5XAX","CITY","N","42.966412","-85.671181" "CA","AB","","","","","55.0","-114.5","false","0","s","A3XAX","STATE","N","55.0","-114.5" "US","SC","Greenville County","Greenville","","","34.848019","-82.400223","false","0","s","A5XAX","CITY","N","34.848019","-82.400223" "US","MA","Suffolk County","Boston","","","42.358631","-71.056702","false","0","s","A5XAX","CITY","N","42.358631","-71.056702"';
echo $res;
echo "<br><br><br>";

$resA = explode(",", $res);
for ( $i = 0; $i < sizeof($resA); $i++){
	if($i % 15 == 0){ //country e.g. "Country"|"DisplayLng" "US"|"-122.329437" "US"|"-112.075768" "US"|"
		echo "<b>".$i."</b>";
		if($i != 0 && $i < 1501){
			$city = trim($resA[$i + 3], '"'); //remove trailing "
			$lat = trim($resA[$i + 6], '"');
			$lng = trim($resA[$i + 7], '"');

			$stmt = $mysqli->prepare("INSERT INTO cities (name, lat, lng) VALUES (?,?,?)");
			$stmt->bind_param("sdd", $city, $lat, $lng);
			$stmt->execute();
		}
	}
}


?>